
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Appendix-ConcurrentHashMap Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="unit-testing.html" />
    
    
    <link rel="prev" href="appendix-i_HashMap.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Java Quick Review</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="chapter01_syntax.html">
            
                <a href="chapter01_syntax.html">
            
                    
                    Syntax
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="chapter02_oo_concepts.html">
            
                <a href="chapter02_oo_concepts.html">
            
                    
                    OO Concepts
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="chapter03_exception.html">
            
                <a href="chapter03_exception.html">
            
                    
                    Exception
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="chapter04_collections.html">
            
                <a href="chapter04_collections.html">
            
                    
                    Collections
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="chapter05_generics.html">
            
                <a href="chapter05_generics.html">
            
                    
                    Generics
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="chapter06_reflection.html">
            
                <a href="chapter06_reflection.html">
            
                    
                    Reflection
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.7" data-path="chapter07_io.html">
            
                <a href="chapter07_io.html">
            
                    
                    IO
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.8" data-path="chapter08_concurrency.html">
            
                <a href="chapter08_concurrency.html">
            
                    
                    Concurrency
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.9" data-path="chapter09_jdbc.html">
            
                <a href="chapter09_jdbc.html">
            
                    
                    JDBC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.10" data-path="chapter10_lambda-expressions.html">
            
                <a href="chapter10_lambda-expressions.html">
            
                    
                    Lambda
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.11" data-path="chapter11_aggregate-operations.html">
            
                <a href="chapter11_aggregate-operations.html">
            
                    
                    Aggregate Operation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.12" data-path="appendix-i_HashMap.html">
            
                <a href="appendix-i_HashMap.html">
            
                    
                    Appendix-HashMap
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="2.13" data-path="appendix-ii_HashMap_ConcurrentHashMap.html">
            
                <a href="appendix-ii_HashMap_ConcurrentHashMap.html">
            
                    
                    Appendix-ConcurrentHashMap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.14" data-path="unit-testing.html">
            
                <a href="unit-testing.html">
            
                    
                    Unit Testing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.15" data-path="best_practices_in_implementation.html">
            
                <a href="best_practices_in_implementation.html">
            
                    
                    Best Practices
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.16" data-path="interview_questions.html">
            
                <a href="interview_questions.html">
            
                    
                    Interview Questions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.17" data-path="code_style.html">
            
                <a href="code_style.html">
            
                    
                    Code Style
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.18" data-path="code_tips.html">
            
                <a href="code_tips.html">
            
                    
                    Code Tips
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Appendix-ConcurrentHashMap</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <p><code>HashMap</code>is a very powerful data structure in<a href="http://crunchify.com/category/java-tutorials/" target="_blank">Java</a>. We use it everyday and almost in all applications. There are quite a few examples which I have written before on<a href="http://crunchify.com/implement-simple-threadsafe-cache-using-hashmap-without-using-synchronized-collection/" target="_blank">How to Implement Threadsafe cache</a>, How to convert<a href="http://crunchify.com/how-to-convert-hashmap-to-arraylist-in-java/" target="_blank">Hashmap to Arraylist</a>?</p>
<p>We used Hashmap in both above examples but those are pretty simple use cases of Hashmap.<code>HashMap is a non-synchronized</code>collection class.</p>
<h4 id="do-you-have-any-of-below-questions">Do you have any of below questions?</h4>
<ul>
<li>What&#x2019;s the difference between ConcurrentHashMap and Collections.synchronizedMap(Map)?</li>
<li>What&#x2019;s the difference between ConcurrentHashMap and Collections.synchronizedMap(Map) in term of performance?</li>
<li>ConcurrentHashMap vs Collections.synchronizedMap()</li>
<li>Popular HashMap and ConcurrentHashMap interview questions</li>
</ul>
<p>In this tutorial we will go over all above queries and reason <code>why and how</code>we could Synchronize Hashmap?</p>
<h3 id="why">Why?</h3>
<p>The Map object is an associative containers that store elements, formed by a combination of a uniquely identify<code>key</code> and a mapped<code>value</code>. If you have very highly concurrent application in which you may want to modify or read key value in different threads then it&#x2019;s ideal to use Concurrent Hashmap. Best example is<a href="http://crunchify.com/java-producer-consumer-example-handle-concurrent-read-write/" target="_blank">Producer Consumer</a> which handles concurrent read/write.</p>
<p>So what does the thread-safe Map means? If<code>multiple threads</code>access a hash map concurrently, and at least one of the threads modifies the map structurally, it<code>must be synchronized externally</code>to avoid an inconsistent view of the contents.</p>
<h3 id="how">How?</h3>
<p>There are two ways we could synchronized<a href="http://crunchify.com/java-hashmap-containskeyobject-key-and-containsvalueobject-value-check-if-key-exists-in-map/" target="_blank">HashMap</a></p>
<ol>
<li>Java Collections synchronizedMap() method</li>
<li>Use ConcurrentHashMap</li>
</ol>
<pre><code class="lang-java"><span class="hljs-comment">//Hashtable</span>
Map&lt;String, String&gt; normalMap = <span class="hljs-keyword">new</span> Hashtable&lt;String, String&gt;();
<span class="hljs-comment">//synchronizedMap</span>
synchronizedHashMap = Collections.synchronizedMap(<span class="hljs-keyword">new</span> HashMap&lt;String, String&gt;());
<span class="hljs-comment">//ConcurrentHashMap</span>
concurrentHashMap = <span class="hljs-keyword">new</span> ConcurrentHashMap&lt;String, String&gt;();
</code></pre>
<p>ConcurrentHashMap</p>
<p>You should use ConcurrentHashMap when you need very high concurrency in your project.
It is thread safe without synchronizing the whole map.
Reads can happen very fast while write is done with a lock.
There is no locking at the object level.
The locking is at a much finer granularity at a hashmap bucket level.
ConcurrentHashMap doesn&#x2019;t throw a ConcurrentModificationException if one thread tries to modify it while another is iterating over it.
ConcurrentHashMap uses multitude of locks.</p>
<p>SynchronizedHashMap</p>
<p>Synchronization at Object level.
Every read/write operation needs to acquire lock.
Locking the entire collection is a performance overhead.
This essentially gives access to only one thread to the entire map &amp; blocks all the other threads.
It may cause contention.
SynchronizedHashMap returns Iterator, which fails-fast on concurrent modification.
Now let&#x2019;s take a look at code</p>
<p>Create class CrunchifyConcurrentHashMapVsSynchronizedHashMap.java
Create object for each HashTable, SynchronizedMap and CrunchifyConcurrentHashMap
Add and retrieve 500k entries from Map
Measure start and end time and display time in milliseconds
We will use ExecutorService to run 5 threads in parallel</p>
<pre><code class="lang-java"><span class="hljs-keyword">package</span> crunchify.com.tutorials;
<span class="hljs-keyword">import</span> java.util.Collections;
<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Hashtable;
<span class="hljs-keyword">import</span> java.util.Map;
<span class="hljs-keyword">import</span> java.util.concurrent.ConcurrentHashMap;
<span class="hljs-keyword">import</span> java.util.concurrent.ExecutorService;
<span class="hljs-keyword">import</span> java.util.concurrent.Executors;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;
<span class="hljs-comment">/**
* <span class="hljs-doctag">@author</span> Crunchify.com
*
*/</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CrunchifyConcurrentHashMapVsSynchronizedMap</span> </span>{
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> THREAD_POOL_SIZE = <span class="hljs-number">5</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Map&lt;String, Integer&gt; crunchifyHashTableObject = <span class="hljs-keyword">null</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Map&lt;String, Integer&gt; crunchifySynchronizedMapObject = <span class="hljs-keyword">null</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Map&lt;String, Integer&gt; crunchifyConcurrentHashMapObject = <span class="hljs-keyword">null</span>;
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>{
<span class="hljs-comment">// Test with Hashtable Object</span>
crunchifyHashTableObject = <span class="hljs-keyword">new</span> Hashtable&lt;String, Integer&gt;();
crunchifyPerformTest(crunchifyHashTableObject);
<span class="hljs-comment">// Test with synchronizedMap Object</span>
crunchifySynchronizedMapObject = Collections.synchronizedMap(<span class="hljs-keyword">new</span> HashMap&lt;String, Integer&gt;());
crunchifyPerformTest(crunchifySynchronizedMapObject);
<span class="hljs-comment">// Test with ConcurrentHashMap Object</span>
crunchifyConcurrentHashMapObject = <span class="hljs-keyword">new</span> ConcurrentHashMap&lt;String, Integer&gt;();
crunchifyPerformTest(crunchifyConcurrentHashMapObject);
}
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">crunchifyPerformTest</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Map&lt;String, Integer&gt; crunchifyThreads)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>{
System.out.println(<span class="hljs-string">&quot;Test started for: &quot;</span> + crunchifyThreads.getClass());
<span class="hljs-keyword">long</span> averageTime = <span class="hljs-number">0</span>;
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
<span class="hljs-keyword">long</span> startTime = System.nanoTime();
ExecutorService crunchifyExServer = Executors.newFixedThreadPool(THREAD_POOL_SIZE);
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; THREAD_POOL_SIZE; j++) {
crunchifyExServer.execute(<span class="hljs-keyword">new</span> Runnable() {
<span class="hljs-meta">@SuppressWarnings</span>(<span class="hljs-string">&quot;unused&quot;</span>)
<span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>{
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">500000</span>; i++) {
Integer crunchifyRandomNumber = (<span class="hljs-keyword">int</span>) Math.ceil(Math.random() * <span class="hljs-number">550000</span>);
<span class="hljs-comment">// Retrieve value. We are not using it anywhere</span>
Integer crunchifyValue = crunchifyThreads.get(String.valueOf(crunchifyRandomNumber));
<span class="hljs-comment">// Put value</span>
crunchifyThreads.put(String.valueOf(crunchifyRandomNumber), crunchifyRandomNumber);
}
}
});
}
<span class="hljs-comment">// Make sure executor stops</span>
crunchifyExServer.shutdown();
<span class="hljs-comment">// Blocks until all tasks have completed execution after a shutdown request</span>
crunchifyExServer.awaitTermination(Long.MAX_VALUE, TimeUnit.DAYS);
<span class="hljs-keyword">long</span> entTime = System.nanoTime();
<span class="hljs-keyword">long</span> totalTime = (entTime - startTime) / <span class="hljs-number">1000000L</span>;
averageTime += totalTime;
System.out.println(<span class="hljs-string">&quot;2500K entried added/retrieved in &quot;</span> + totalTime + <span class="hljs-string">&quot; ms&quot;</span>);
}
System.out.println(<span class="hljs-string">&quot;For &quot;</span> + crunchifyThreads.getClass() + <span class="hljs-string">&quot; the average time is &quot;</span> + averageTime / <span class="hljs-number">5</span> + <span class="hljs-string">&quot; ms\n&quot;</span>);
}
}
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="appendix-i_HashMap.html" class="navigation navigation-prev " aria-label="Previous page: Appendix-HashMap">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="unit-testing.html" class="navigation navigation-next " aria-label="Next page: Unit Testing">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Appendix-ConcurrentHashMap","level":"2.13","depth":1,"next":{"title":"Unit Testing","level":"2.14","depth":1,"path":"java-quick-review/unit-testing.md","ref":"java-quick-review/unit-testing.md","articles":[]},"previous":{"title":"Appendix-HashMap","level":"2.12","depth":1,"path":"java-quick-review/appendix-i_HashMap.md","ref":"java-quick-review/appendix-i_HashMap.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["livereload"],"pluginsConfig":{"livereload":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"java-quick-review/appendix-ii_HashMap_ConcurrentHashMap.md","mtime":"2020-12-20T13:04:36.793Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-12-20T13:00:37.937Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

